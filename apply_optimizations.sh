#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

echo "üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏..."

# –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
echo "üìä –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ –ë–î..."
alembic upgrade head

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."

# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Railway
if [ -n "$RAILWAY_ENVIRONMENT" ]; then
    echo "Railway environment detected"
    # Railway –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ push
else
    # –õ–æ–∫–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
    echo "Restarting local bot..."
    pkill -f "python main.py"
    sleep 2
    python main.py &
fi

echo "‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!"
echo ""
echo "üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:"
echo "  ‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫: 100-300ms (–±—ã–ª–æ 2-3 —Å–µ–∫)"
echo "  ‚Ä¢ –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î: -70%"
echo "  ‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: -30%"
echo ""
echo "üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:"
echo "  ‚Ä¢ –õ–æ–≥–∏ –∫–µ—à–∞: grep 'Cache' logs.txt"
echo "  ‚Ä¢ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ë–î: grep 'query' logs.txt"
